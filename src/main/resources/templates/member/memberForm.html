<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultrag.net.nz/.thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>도토리 플래너 - 회원가입</title>

    <!-- 부트스트랩 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="bs/css/styles.css" th:href="@{/bs/css/styles.css}" rel="stylesheet"/>

    <!-- 폰트 -->
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-barun-gothic.css" rel="stylesheet">

    <!-- 해당 페이지에서 쓸 css -->
    <style layout:fragment="mystyle" th:inline="css">
        .signup_form {
            width: 100%;
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            background-color: #ffffff;
        }

        .signup_form_inner {
            padding: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #7c583b;
            box-shadow: 0 0 5px rgba(124, 88, 59, 0.2);
        }

        .check-btn {
            padding: 0.8rem 1.2rem;
            background-color: #7c583b;
            color: white;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .check-btn:hover {
            background-color: #634629;
        }

        .signup-btn {
            width: 100%;
            padding: 0.8rem;
            background-color: #7c583b;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 1rem;
        }

        .signup-btn:hover {
            background-color: #634629;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .login-link {
            text-align: center;
            margin-top: 1.5rem;
        }

        .login-link a {
            color: #7c583b;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .login-link a:hover {
            color: #634629;
            text-decoration: underline;
        }

        .input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .input-group .form-input {
            margin-bottom: 0;
        }

        .privacy-policy {
            margin-bottom: 1.5rem;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background-color: #fcfcfc;
        }

        .privacy-header {
            padding: 1rem;
            background-color: #f8f8f8;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .privacy-header:hover {
            background-color: #f0f0f0;
        }

        .privacy-content {
            padding: 1rem;
            display: none;
            font-size: 0.9rem;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }

        .privacy-content.show {
            display: block;
        }

        .privacy-content h2 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #7c583b;
        }

        .privacy-content p {
            margin-bottom: 1rem;
        }

        .privacy-checkbox {
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .privacy-checkbox input[type="checkbox"] {
            width: 1.2rem;
            height: 1.2rem;
            accent-color: #7c583b;
        }

        .privacy-checkbox label {
            font-size: 0.9rem;
            color: #333;
        }

        .arrow {
            transition: transform 0.3s ease;
        }

        .arrow.rotate {
            transform: rotate(180deg);
        }

.terms-container {
    margin-bottom: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.terms-section {
    border: 1px solid #e0e0e0;
    border-radius: 5px;
    background-color: #fcfcfc;
}

.agreement-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.all-agree {
    padding: 1rem;
    margin-bottom: 1rem;
    background-color: #f8f8f8;
    border: 1px solid #e0e0e0;
    border-radius: 5px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.all-agree input[type="checkbox"] {
    width: 1.2rem;
    height: 1.2rem;
    accent-color: #7c583b;
}

.all-agree label {
    font-weight: bold;
    color: #7c583b;
}

.required-text {
    color: #dc3545;
    font-size: 0.8rem;
    margin-left: 0.3rem;
}

.optional-text {
    color: #6c757d;
    font-size: 0.8rem;
    margin-left: 0.3rem;
}

.signup-title {
  font-family: 'GyeonggiTitle', 'NanumBarunGothic', sans-serif;
  color: #7c583b;
  font-size: 2rem;
  position: relative;
  display: block;
  text-align: center;
  padding: 0 15px;
  margin: 2rem auto;
  width: fit-content;
}

@font-face {
    font-family: 'GyeonggiTitle';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/GyeonggiTitleM.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}
    </style>

    <!-- 해당 페이지에서 쓸 js -->
    <script layout:fragment="myscript" th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // 중복 체크 함수
        window.checkDuplicate = function(type) {
            const value = document.getElementById(type === 'loginId' ? 'loginId' : 'email').value;

            if (!value) {
                alert(type === 'loginId' ? '아이디를 입력해주세요.' : '이메일을 입력해주세요.');
                return;
            }

            fetch(`/member/check-${type}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    [type]: value
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.available) {
                        alert('사용 가능합니다.');
                    } else {
                        alert('이미 사용중입니다.');
                    }
                })
                .catch(error => {
                    alert('중복 확인 중 오류가 발생했습니다.');
                });
        };


        // 약관 토글 함수
        window.toggleTerms = function(element) {
            const content = element.nextElementSibling;
            const arrow = element.querySelector('.arrow');
            content.classList.toggle('show');
            arrow.classList.toggle('rotate');
        };

        // 전체 동의 처리
        const agreeAllCheckbox = document.getElementById('agree-all');
        const requiredCheckboxes = document.querySelectorAll('.required-agree');
        const optionalCheckboxes = document.querySelectorAll('.optional-agree');
        
        agreeAllCheckbox.addEventListener('change', function() {
            const isChecked = this.checked;
            requiredCheckboxes.forEach(checkbox => checkbox.checked = isChecked);
            optionalCheckboxes.forEach(checkbox => checkbox.checked = isChecked);
        });

        // 개별 체크박스 변경 시 전체 동의 상태 업데이트
        const allCheckboxes = document.querySelectorAll('.required-agree, .optional-agree');
        allCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const allChecked = Array.from(allCheckboxes).every(cb => cb.checked);
                agreeAllCheckbox.checked = allChecked;
            });
        });

        // 폼 제출 전 필수 약관 확인
        document.querySelector('form').addEventListener('submit', function(e) {
            const requiredChecked = Array.from(requiredCheckboxes).every(cb => cb.checked);
            if (!requiredChecked) {
                e.preventDefault();
                alert('필수 약관에 모두 동의해주세요.');
            }
        });
    });
</script>
</head>
<body>
<div layout:fragment="content">
    <div class="signup_form">
        <form th:action="@{/member/register}" th:object="${memberDTO}" method="post">
            <div class="signup_form_inner">
              <h3 class="text-center mb-4 signup-title">다람쥐 되기</h3>

                <div class="form-group">
                    <label class="form-label" for="loginId">아이디</label>
                    <div class="input-group">
                        <input type="text" class="form-input" id="loginId" th:field="*{loginId}" required 
                               placeholder="아이디를 입력하세요">
                        <button type="button" class="check-btn" onclick="checkDuplicate('loginId')">
                            중복확인
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">비밀번호</label>
                    <input type="password" class="form-input" id="password" th:field="*{password}" required
                           placeholder="비밀번호를 입력하세요">
                </div>

                <div class="form-group">
                    <label class="form-label" for="name">이름</label>
                    <input type="text" class="form-input" id="name" th:field="*{name}" required
                           placeholder="이름을 입력하세요">
                </div>

                <div class="form-group">
                    <label class="form-label" for="email">이메일</label>
                    <div class="input-group">
                        <input type="email" class="form-input" id="email" th:field="*{email}" required
                               placeholder="이메일을 입력하세요">
                        <button type="button" class="check-btn" onclick="checkDuplicate('email')">
                            중복확인
                        </button>
                    </div>
                </div>

                <div class="terms-container">
    <div class="all-agree">
        <input type="checkbox" id="agree-all">
        <label for="agree-all">모든 약관에 동의합니다</label>
    </div>

    <div class="agreement-group">
        <!-- 개인정보 처리방침 -->
        <div class="terms-section">
            <div class="privacy-header" onclick="toggleTerms(this)">
                <span>개인정보 처리방침<span class="required-text">(필수)</span></span>
                <span class="arrow">▼</span>
            </div>
            <div class="privacy-content">
              <h2>개인정보 처리방침 (개인정보보호법 제30조에 따른 고지)</h2>
              <p>도토리 플래너(이하 '회사')는 이용자의 개인정보를 중요시하며, 「개인정보 보호법」 등 관련 법령을 준수합니다. 본 방침은 앱 및 웹사이트 이용 시 수집되는 개인정보의 처리 방식과 그 보호 조치를 안내합니다.</p>

              <h2>1. 수집하는 개인정보 항목</h2>
              <p>회원가입 시: 이메일, 비밀번호, 닉네임<br>
                선택 항목: 프로필 이미지, 생년월일<br>
                서비스 이용 시 자동 수집: 접속 로그, 이용기록, 디바이스 정보, IP주소</p>

              <h2>2. 개인정보 수집 목적</h2>
              <p>• 회원 식별 및 인증<br>
                • 예산 관리 및 소비 기록 분석 제공<br>
                • 사용자 맞춤형 서비스 제공<br>
                • 고객 문의 대응 및 고지사항 전달</p>

              <h2>3. 개인정보 보유 및 이용 기간</h2>
              <p>• 회원 탈퇴 시 즉시 파기<br>
                • 관련 법령에 따라 일정 기간 보관이 필요한 경우는 예외<br>
                예) 전자상거래 등에서의 소비자 보호에 관한 법률에 의거하여 거래기록 5년 보관</p>

              <h2>4. 개인정보 제공 및 위탁</h2>
              <p>원칙적으로 제3자에게 제공하지 않으며, 수탁 업체가 필요한 경우 사전 동의를 받습니다.</p>

              <h2>5. 이용자의 권리 및 행사 방법</h2>
              <p>언제든지 개인정보 열람, 수정, 삭제, 처리 정지를 요청할 수 있습니다.<br>
                문의처: rlaalswns199@gmail.com</p>

            </div>
        </div>
        <div class="privacy-checkbox">
            <input type="checkbox" id="privacy-agree" name="termsAgree" th:field="*{privacyAgree}" required class="required-agree">
            <label for="privacy-agree">개인정보 처리방침에 동의합니다</label>
        </div>

        <!-- 서비스 이용약관 -->
        <div class="terms-section">
            <div class="privacy-header" onclick="toggleTerms(this)">
                <span>서비스 이용약관<span class="required-text">(필수)</span></span>
                <span class="arrow">▼</span>
            </div>
            <div class="privacy-content">
                <h2>서비스 이용약관</h2>
                <h2>제1조 (목적)</h2>
                <p>이 약관은 도토리 플래너(이하 '회사')가 제공하는 가계부 및 예산 서비스(이하 '서비스')의 이용 조건 및 절차, 회사와 이용자의 권리·의무 및 책임사항을 규정합니다.</p>

                <h2>제2조 (가입 및 이용 계약 체결)</h2>
                <p>이용자는 본 약관에 동의함으로써 회원가입이 완료됩니다.<br>
                회사는 관련 법령에 따라 일부 가입을 제한할 수 있습니다.</p>

                <h2>제3조 (서비스의 제공)</h2>
                <p>회사는 다음과 같은 서비스를 제공합니다:<br>
                • 예산 계획 수립 및 지출 기록<br>
                • 월별 통계 및 분석 리포트<br>
                • 알림 및 목표 달성 포인트 제공</p>

                <h2>제4조 (회원의 의무)</h2>
                <p>• 타인의 개인정보 도용 금지<br>
                • 서비스의 안정적인 운영 방해 행위 금지<br>
                • 비밀번호 등 관리 책임은 회원 본인에게 있음</p>

                <h2>제5조 (서비스의 중단)</h2>
                <p>서버 점검, 시스템 오류, 천재지변 시 서비스 제공을 일시 중단할 수 있습니다.</p>

                <h2>제6조 (계약 해지 및 이용 제한)</h2>
                <p>회원은 언제든지 서비스 탈퇴가 가능하며, 회사는 부정 이용 시 사전 통지 후 이용을 제한할 수 있습니다.</p>

                <h2>제7조 (면책조항)</h2>
                <p>회사는 사용자의 소비 결정에 따른 손해에 대해 책임지지 않습니다.</p>
            </div>
        </div>
        <div class="privacy-checkbox">
            <input type="checkbox" id="terms-agree" required th:field="*{termsAgree}" class="required-agree">
            <label for="terms-agree">서비스 이용약관에 동의합니다</label>
        </div>

        <!-- 마케팅 수신 동의 -->
        <div class="terms-section">
            <div class="privacy-header" onclick="toggleTerms(this)">
                <span>마케팅 수신 동의<span class="optional-text">(선택)</span></span>
                <span class="arrow">▼</span>
            </div>
            <div class="privacy-content">
                <h2>마케팅 수신 동의서</h2>
                <p>도토리 플래너는 이용자에게 유용한 혜택 및 정보를 제공하기 위해 아래와 같은 방식으로 마케팅 정보를 전송할 수 있습니다.</p>

                <h2>수신 항목</h2>
                <p>신규 기능 안내, 프로모션/이벤트 정보, 포인트 혜택 안내 등</p>

                <h2>수신 수단</h2>
                <p>이메일, 앱 푸시 알림</p>

                <h2>수신 동의 철회</h2>
                <p>언제든지 설정 페이지 또는 고객센터를 통해 수신을 거부하실 수 있습니다.</p>

                <p>※ 미동의 시에도 서비스 이용에 제한은 없습니다.</p>
            </div>
        </div>
        <div class="privacy-checkbox">
            <input type="checkbox" id="marketing-agree" th:field="*{marketingAgree}" class="optional-agree">
            <label for="marketing-agree">마케팅 수신에 동의합니다</label>
        </div>
    </div>
</div>

                <button type="submit" class="signup-btn">가입하기</button>

                <div class="login-link">
                    <p>이미 계정이 있으신가요? <a href="/member/loginForm">로그인하기</a></p>
                </div>
            </div>
        </form>
    </div>
</div>
</body>
</html>