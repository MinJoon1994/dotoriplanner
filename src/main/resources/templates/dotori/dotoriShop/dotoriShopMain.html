<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultrag.net.nz/.thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
  <meta charset="utf-8" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style th:inline="css">
    .dotoriShop-container {
      display: flex;
      flex-direction: column;
    }

    /* ------------ ë©”ì¸ ------------- */
    .dotoriShop-body {
      display: flex;
      gap: 20px;
      padding: 20px;
    }

    .character-div {
      width: 800px;
      height: 800px;
      background-size: cover;
      background-position: center;
    }
    .character-img {
      width: 800px;
      height: 800px;
    }
    .item-image {
      width: 200px;
      height: 200px;
      object-fit: contain;
      margin: 5px;
      cursor: pointer;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .item-image.selected {
      border: 3px solid #28a745; /* ì´ˆë¡ìƒ‰ */
    }
  </style>
</head>

<body>
<div layout:fragment="content">
  <div class="dotoriShop-container">
    <!-- ---------------- í—¤ë” --------------------- -->
    <header class="dotoriShop-header">
      <h2> ğŸ›ï¸ ë„í† ë¦¬ ìƒì  </h2>
    </header>

    <!-- ---------------- ë©”ì¸ --------------------- -->
    <main class="dotoriShop-body">

      <!-- ì¼€ë¦­í„° -->
      <div class="character-div">
        <img class="character-img" id="mainCharacter" th:src="@{/images/shop/character/ê¸°ë³¸ì¼€ë¦­í„°.png}" alt="ì¼€ë¦­í„°" />
      </div>

      <!-- ìƒì  -->
      <div>
        <!-- ì˜ìƒ ì„ íƒ ë©”ë‰´ -->
        <div class="tab-buttons">
          <button onclick="showCategory('avatar')">ì•„ë°”íƒ€</button>
          <button onclick="showCategory('background')">ë°°ê²½</button>
        </div>

        <!-- ì˜ìƒ -->
        <div class="item-list" id="item-list">
          <!-- JSë¡œ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
        </div>
      </div>
    </main>

    <aside class="dotoriShop-aside">

    </aside>

    <!-- ---------------- í‘¸í„° --------------------- -->
    <!-- ë˜ëŒë¦¬ê¸°, ì €ì¥í•˜ê¸° -->
    <footer>
      <button onclick="buySelectedItem()">êµ¬ë§¤í•˜ê¸°</button>
    </footer>
  </div>

  <script>
    // í˜„ì¬ ì„ íƒëœ ì•¡ì„¸ì„œë¦¬ íƒ­ ì¹´í…Œê³ ë¦¬ (ì¼€ë¦­í„°/ë°°ê²½ ì¤‘ í•˜ë‚˜)
    let currentCategory = 'avatar';

    let selection = {
      avatar: null,
      background: null
    };

    // ë˜ëŒë¦¬ê¸° ê¸°ëŠ¥ì„ ìœ„í•œ ì´ì „ ì„ íƒ ì €ì¥ ê°ì²´
    let previousSelections = {};

    // ì¹´í…Œê³ ë¦¬ë³„ ì•¡ì„¸ì„œë¦¬ í•­ëª© ë°ì´í„°
    const items = {
      avatar: [
        { name: 'ì„ íƒí•´ì œ', price: '0', src: '/images/shop/abatar/ì„ íƒí•´ì œ.png', isClear: true },
        { name: 'ê°œë°œì', price: '800', src: '/images/shop/abatar/ê°œë°œì.png' },
        { name: 'ê³µì£¼', price: '800', src: '/images/shop/abatar/ê³µì£¼.png' },
        { name: 'ê¸°ì‚¬', price: '800', src: '/images/shop/abatar/ê¸°ì‚¬.png' },
        { name: 'ë§¨ìœ ', price: '800', src: '/images/shop/abatar/ë§¨ìœ .png' },
        { name: 'ë°°íŠ¸ë§¨', price: '800', src: '/images/shop/abatar/ë°°íŠ¸ë§¨.png' },
        { name: 'ìƒì–´', price: '800', src: '/images/shop/abatar/ìƒì–´.png' },
        { name: 'ìŠˆí¼ë§¨', price: '800', src: '/images/shop/abatar/ìŠˆí¼ë§¨.png' },
        { name: 'ì˜¤ì§•ì–´ê²Œì„', price: '800', src: '/images/shop/abatar/ì˜¤ì§•ì–´ê²Œì„.png' },
        { name: 'ìš”ë¦¬ì‚¬', price: '800', src: '/images/shop/abatar/ìš”ë¦¬ì‚¬.png' },
        { name: 'ì£„ìˆ˜', price: '800', src: '/images/shop/abatar/ì£„ìˆ˜.png' },
        { name: 'í† ë¼', price: '800', src: '/images/shop/abatar/í† ë¼.png' },
        { name: 'í”„ë‘ì¼„ìŠˆíƒ€ì¸', price: '800', src: '/images/shop/abatar/í”„ë‘ì¼„ìŠˆíƒ€ì¸.png' },
      ],
      background: [
        { name: 'ì„ íƒí•´ì œ', price: '0', src: '/images/shop/bg/ì„ íƒí•´ì œ.png', isClear: true },
        { name: 'ê°ì˜¥', price: '500', src: '/images/shop/bg/ê°ì˜¥.png' },
        { name: 'ê³¨ëª©', price: '500', src: '/images/shop/bg/ê³¨ëª©.png' },
        { name: 'ê¶ì „', price: '500', src: '/images/shop/bg/ê¶ì „.png' },
        { name: 'ì‚°ì†', price: '500', src: '/images/shop/bg/ì‚°ì†.png' },
        { name: 'ì„±', price: '500', src: '/images/shop/bg/ì„±.png' },
        { name: 'ì‹¬í•´', price: '500', src: '/images/shop/bg/ì‹¬í•´.png' },
        { name: 'ì˜¤ì§•ì–´ì„¸íŠ¸ì¥1', price: '500', src: '/images/shop/bg/ì˜¤ì§•ì–´ì„¸íŠ¸ì¥1.png' },
        { name: 'ì˜¤ì§•ì–´ì„¸íŠ¸ì¥2', price: '500', src: '/images/shop/bg/ì˜¤ì§•ì–´ì„¸íŠ¸ì¥2.png' },
        { name: 'ì£¼ë°©', price: '500', src: '/images/shop/bg/ì£¼ë°©.png' },
        { name: 'ì¶•êµ¬ì¥', price: '500', src: '/images/shop/bg/ì¶•êµ¬ì¥.png' },
      ]
    };

    function showCategory(category) {
      currentCategory = category;
      const listDiv = document.getElementById('item-list');
      listDiv.innerHTML = '';

      items[category].forEach(item => {
        const img = document.createElement('img');
        img.src = item.src;
        img.alt = item.name;
        img.classList.add('item-image');

        img.onclick = () => {

          if (item.isClear) {
            selection[category] = null;
          } else {
            selection[category] = item;
          }

          // ì„ íƒ íš¨ê³¼ ì—…ë°ì´íŠ¸
          updateSelectedHighlight(category);

          updateCharacter();
        };

        listDiv.appendChild(img);
      });
    }

    function updateCharacter() {
      const mainCharacter = document.getElementById('mainCharacter');
      const container = document.querySelector('.character-div');

      if (selection.avatar) {
        mainCharacter.src = selection.avatar.src;
      } else {
        mainCharacter.src = '/images/shop/character/ê¸°ë³¸ì¼€ë¦­í„°.png';
      }

      if (selection.background) {
        container.style.backgroundImage = `url('${selection.background.src}')`;
        container.style.backgroundSize = 'cover';
        container.style.backgroundPosition = 'center';
      } else {
        container.style.backgroundImage = '';
      }
    }
    function buySelectedItem() {
  const avatar = selection.avatar;
  const background = selection.background;

  if (!avatar && !background) {
    Swal.fire({
      icon: 'info',
      title: 'ì„ íƒëœ ì•„ì´í…œ ì—†ìŒ',
      text: 'êµ¬ë§¤í•  ì•„ì´í…œì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.',
    });
    return;
  }

  const selectedItems = [];

  if (avatar && !avatar.isClear) {
    selectedItems.push(`${avatar.name} ${avatar.price}ì›`);
  }

  if (background && !background.isClear) {
    selectedItems.push(`${background.name} ${background.price}ì›`);
  }

  Swal.fire({
    title: 'êµ¬ë§¤ ë‚´ì—­ í™•ì¸',
    html: selectedItems.join('<br>'),
    icon: 'question',
    showCancelButton: true,
    cancelButtonText: 'ì·¨ì†Œ',
    confirmButtonText: 'êµ¬ë§¤í•˜ê¸°',
    }).then(result => {
      if (result.isConfirmed) {
        // âœ… ë™ì  form ìƒì„±
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/dotori/shopping'; // ì´ ê²½ë¡œì— POST ì»¨íŠ¸ë¡¤ëŸ¬ í•„ìš”

        if (avatar && !avatar.isClear) {
          const avatarInput = document.createElement('input');
          avatarInput.type = 'hidden';
          avatarInput.name = 'avatar';
          avatarInput.value = avatar.name;
          form.appendChild(avatarInput);
        }

        if (background && !background.isClear) {
          const bgInput = document.createElement('input');
          bgInput.type = 'hidden';
          bgInput.name = 'background';
          bgInput.value = background.name;
          form.appendChild(bgInput);
        }

        document.body.appendChild(form);
        form.submit();
      }
    });
  }
    function updateSelectedHighlight(category) {
      const itemList = document.getElementById('item-list');
      const images = itemList.querySelectorAll('.item-image');

      images.forEach(img => {
        // alt ì†ì„±ì´ nameê³¼ ë™ì¼í•˜ë‹¤ê³  ê°€ì •
        if (
          selection[category] &&
          img.alt === selection[category].name &&
          !selection[category].isClear
        ) {
          img.classList.add('selected');
        } else {
          img.classList.remove('selected');
        }
      });
    }
    document.addEventListener('DOMContentLoaded', () => {
      showCategory('avatar');
    });

  </script>
</div>

</body>
</html>

